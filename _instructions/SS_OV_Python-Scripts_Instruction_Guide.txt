Python pipeline:

1.	cde-pre-processing - converts Project 5 COVID CDE spreadsheet to be digested by MetaMap. This step can be omitted.
2.	batch_query_pipeline- API to MetaMap set of scripts, created, and supported by BRICS developers. The main GitHub for developing these scripts is Kevin A. GitHub repository. The package allows to load in a data dictionary and map CDE semantics to UMLS CUIs using MetaMap API from NLM
3.	umls-to-vocabularies- for each CDE/each UMLS CUI from #2, returns the corresponding NCIt CUI.
4.	nci-concept-lineage - contains “NCIt concept lineage retrieval form EVS file.xlsx” file which uses a formula applied to December 2022 NCI Thesaurus download from EVS.
5.	nci-concept-to-tree -  for each CDE, creates a visual representation the NCIt concept hierarchy from #3 as tree, where NCIt concepts are presented as branches and each CDE as a leaf.

Requirements:
The scripts were tested under Anaconda Navigator (Anaconda 3) 
The UMLS API key needed which can be found in the "My Profile" section of your account at UMLS.

Tools:
Anaconda distribution, JupyterLab, Jupyter Notebook

Anaconda environment: 
Download the .yaml file to use as Anaconda environment, to make your life easier.

Python modules used:
The modules needed to run the above three scripts include the following:

Pandas
Numpy
OS
treelib
Tree(from treelib)
pathlib
Path(from Path)
shutil
glob
tkinter
filedialog(from tkinter)
json
pprint
openpyxl
requests
_________________
Pipeline steps:

Step 1: 
Pre-processing step (cde-pre-processing): addressing the issue that all CDE repositories have slightly different templates
From Project 5 COVID CDE spreadsheet take 2 columns: CDE Name and Question Text. Save as a CSV.
Run through cde-pre-processing.py
Save the output as a CSV file

Step 2:  
API to MetaMap set of scripts (batch_query_pipeline.py ): load in a data dictionary and map CDE semantics to UMLS CUIs using MetaMap API from NLM
Set up the configuration file (can be done once)
Specifically enter user name and API key (can be done once)
Take the output from step #1, run through batch_query_pipeline.py
Review the output, select the UMLS CUIs best match CDE semantics
Format and save the output as .xls file

Step 3: 
UMLS to NCIt (umls-to-vocabularies.py): returning NCIt CUIs for UMLS CUIs
Take the output from the step #2.
Run thorough umls-to-vocabularies.py
Save the output as a CSV file

Step 4: 
Retrieve NCIt concept lineage (nci-concept-lineage)
nci-concept-lineage - contains “NCIt concept lineage retrieval form EVS file.xlsx” file 
which uses a formula applied to December 2022 NCI Thesaurus download from EVS.

Take the output from #3 and 
Apply the MS Excel formula from “NCIt concept lineage retrieval from EVS file.xlsx” 
Save the output file as a CSV file.

Step 5: 
Creates trees from multiple COVID CDE tree lineages
nci-concept-to-tree -  for each CDE, create a visual representation the NCIt concept hierarchy from #3 as tree, where NCIt concepts are presented as branches and each CDE as a leaf.

Take an output from #4
Run through nci-concept-to-tree.py 
Review and save the output as a TXT file

__________









